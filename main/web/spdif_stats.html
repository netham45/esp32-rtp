<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPDIF Decoder Statistics</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-group {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .stat-group h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .stat-label {
            font-weight: 500;
            color: #555;
        }
        .stat-value {
            font-family: monospace;
            color: #000;
            font-weight: 600;
        }
        .error-value {
            color: #dc3545;
        }
        .success-value {
            color: #28a745;
        }
        .refresh-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .auto-refresh-label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .nav-back {
            display: inline-block;
            margin-bottom: 20px;
            color: #007bff;
            text-decoration: none;
        }
        .nav-back:hover {
            text-decoration: underline;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }
        .status-synced {
            background-color: #28a745;
        }
        .status-not-synced {
            background-color: #dc3545;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #f5c6cb;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="nav-back">‚Üê Back to Settings</a>
        
        <h1>SPDIF Decoder Statistics</h1>
        
        <div class="refresh-controls">
            <button id="refresh-button" onclick="refreshStats()">Refresh</button>
            <button id="reset-button" onclick="resetStats()" class="secondary">Reset Statistics</button>
            <label class="auto-refresh-label">
                <input type="checkbox" id="auto-refresh" onchange="toggleAutoRefresh()" checked>
                Auto-refresh (1s)
            </label>
            <span>Status: <span id="sync-status">Unknown</span><span id="sync-indicator" class="status-indicator"></span></span>
        </div>

        <div id="loading" class="loading">Loading statistics...</div>
        <div id="error-message" class="error-message" style="display: none;"></div>
        
        <div id="stats-container" class="stats-grid" style="display: none;">
            <!-- Symbol & Processing Stats -->
            <div class="stat-group">
                <h3>Processing Statistics</h3>
                <div class="stat-item">
                    <span class="stat-label">Total Symbols Processed:</span>
                    <span class="stat-value" id="total_symbols_processed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Processing Cycles:</span>
                    <span class="stat-value" id="processing_cycles">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Symbols/Cycle:</span>
                    <span class="stat-value" id="avg_symbols_per_cycle">0.0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Max Symbols/Cycle:</span>
                    <span class="stat-value" id="max_symbols_per_cycle">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Empty Symbols:</span>
                    <span class="stat-value" id="empty_symbols">0</span>
                </div>
            </div>

            <!-- RMT Statistics -->
            <div class="stat-group">
                <h3>RMT Statistics</h3>
                <div class="stat-item">
                    <span class="stat-label">RMT Callbacks:</span>
                    <span class="stat-value" id="rmt_callbacks">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">RMT Symbols Received:</span>
                    <span class="stat-value" id="rmt_symbols_received">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">RMT Buffer Overflows:</span>
                    <span class="stat-value error-value" id="rmt_buffer_overflows">0</span>
                </div>
            </div>

            <!-- Pulse Type Stats -->
            <div class="stat-group">
                <h3>Pulse Types</h3>
                <div class="stat-item">
                    <span class="stat-label">Short Pulses (0.5T):</span>
                    <span class="stat-value" id="short_pulses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Medium Pulses (1.0T):</span>
                    <span class="stat-value" id="medium_pulses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Long Pulses (1.5T):</span>
                    <span class="stat-value" id="long_pulses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Unknown Pulses:</span>
                    <span class="stat-value error-value" id="unknown_pulses">0</span>
                </div>
            </div>

            <!-- Preamble Stats -->
            <div class="stat-group">
                <h3>Preambles</h3>
                <div class="stat-item">
                    <span class="stat-label">B (Block Start):</span>
                    <span class="stat-value" id="preamble_b_detected">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">M (Left Channel):</span>
                    <span class="stat-value" id="preamble_m_detected">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">W (Right Channel):</span>
                    <span class="stat-value" id="preamble_w_detected">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Preambles:</span>
                    <span class="stat-value" id="total_preambles">0</span>
                </div>
            </div>

            <!-- Bit Decoding Stats -->
            <div class="stat-group">
                <h3>Bit Decoding</h3>
                <div class="stat-item">
                    <span class="stat-label">Bits Decoded (0):</span>
                    <span class="stat-value" id="bits_decoded_0">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Bits Decoded (1):</span>
                    <span class="stat-value" id="bits_decoded_1">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Bits Decoded:</span>
                    <span class="stat-value" id="total_bits_decoded">0</span>
                </div>
            </div>

            <!-- Audio Data Stats -->
            <div class="stat-group">
                <h3>Audio Data</h3>
                <div class="stat-item">
                    <span class="stat-label">Subframes Completed:</span>
                    <span class="stat-value" id="subframes_completed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Left Channel Samples:</span>
                    <span class="stat-value" id="left_channel_samples">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Right Channel Samples:</span>
                    <span class="stat-value" id="right_channel_samples">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Stereo Pairs Output:</span>
                    <span class="stat-value success-value" id="stereo_pairs_output">0</span>
                </div>
            </div>

            <!-- Frame & Block Stats -->
            <div class="stat-group">
                <h3>Frames & Blocks</h3>
                <div class="stat-item">
                    <span class="stat-label">Frames Completed:</span>
                    <span class="stat-value" id="frames_completed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Blocks Completed:</span>
                    <span class="stat-value" id="blocks_completed">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Sample Rate:</span>
                    <span class="stat-value" id="last_sample_rate">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Timing Updates:</span>
                    <span class="stat-value" id="timing_updates">0</span>
                </div>
            </div>

            <!-- Error Stats -->
            <div class="stat-group">
                <h3>Errors</h3>
                <div class="stat-item">
                    <span class="stat-label">Sync Errors:</span>
                    <span class="stat-value error-value" id="sync_errors">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">BMC Violations:</span>
                    <span class="stat-value error-value" id="bmc_violations">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Unexpected Long Pulses:</span>
                    <span class="stat-value error-value" id="unexpected_long_pulses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Incomplete Subframes:</span>
                    <span class="stat-value error-value" id="incomplete_subframes">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Parity Errors:</span>
                    <span class="stat-value error-value" id="parity_errors">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Buffer Overruns:</span>
                    <span class="stat-value error-value" id="buffer_overruns">0</span>
                </div>
            </div>

            <!-- Sync State Stats -->
            <div class="stat-group">
                <h3>Synchronization</h3>
                <div class="stat-item">
                    <span class="stat-label">Sync Acquisitions:</span>
                    <span class="stat-value success-value" id="sync_acquisitions">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Sync Losses:</span>
                    <span class="stat-value error-value" id="sync_losses">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Sync State:</span>
                    <span class="stat-value" id="current_sync_state">Not Synced</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Max Consecutive Errors:</span>
                    <span class="stat-value" id="max_consecutive_errors">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Consecutive Errors:</span>
                    <span class="stat-value" id="current_consecutive_errors">0</span>
                </div>
            </div>

            <!-- Debug Info -->
            <div class="stat-group">
                <h3>Debug Information</h3>
                <div class="stat-item">
                    <span class="stat-label">Last Error Position:</span>
                    <span class="stat-value" id="last_error_position">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Last Error Type:</span>
                    <span class="stat-value" id="last_error_type">None</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Uptime (seconds):</span>
                    <span class="stat-value" id="uptime">0</span>
                </div>
            </div>
        </div>
    </div>

    <script src="spdif_stats.js"></script>
</body>
</html>